Title: Ноябрь 2016 кратко
Date: 2016-12-15 00:00
Category: News
Slug: 2016-november-recap
Lang: ru

![Постройка здания][screenshot]


Эта статья описывает начало разделения библиотеки MJIN на модули.

Как только мы собрали OpenSceneGraph для Android, стало очевидно, что часть функционала MJIN не нужна на Android. Например, UIQt - это основа интерфейса Редактора. Раз Редактор - это приложение для ПК, то UIQt не нужен на Android.

Мы решили рассмотреть два подхода к разделению MJIN на модули: во время сборки (build-time) и исполнения (run-time).
Разделение **во время сборки** означает гибкую систему настроек MJIN, что позволит собирать её различно под каждую платформу.
Разделение **во время исполнения** означает разделение MJIN на несколько небольших библиотек с последующим соединением во время исполнения, что позволит легко менять функционал без повторной сборки.

**Исследование разделения во время исполнения.**

Т.к. разделение во время исполнения имеет больше преимуществ, мы начали с этого подхода. Самый простой способ достичь его заключался в использовании C API, т.к. правила C ABI намного проще правил C++ ABI.

Мы создали маленький проект, включающий в себя приложение, библиотеку и плагин:

* **Приложение** было слинковано с библиотекой и использовало её для загрузки плагина.
* **Библиотека** предоставляла функции для регистрации плагина и вызывала его функции.
* **Плагин** предоставлял функции для библиотеки и вызывал её функции.

Исследование прошло на ура: проект работал в полном соответствии с нашими ожиданиями на Linux и Windows. Тем не менее, т.к. MJIN на текущий момент является большой монолитной сущностью, мы отложили применение C API до окончания разделения во время сборки.

**Начало разделения во время сборки.**

Мы выделили следующие модули из MJIN:

* Android: предоставляет Java Native Interface (JNI) к MJIN
* Sound: предоставляет доступ к OpenAL
* UIQt: предоставляет доступ к Qt




Модули Sound и UIQt на текущий момент статически линкуются в MJIN, тогда как модуль Android линкуется динамически из-за ограничений JNI.

В следующем году мы изменим структуру MJIN так, чтобы её можно было легче собрать под разные платформы.

На этом мы заканчиваем статью о начале разделения библиотеки MJIN на модули.

[screenshot]: ../../images/2016-12-15_2016-november-recap.png
